services:
  # Single image built once
  worker:
    build: .
    env_file:
      - .env
    deploy:
      replicas: 1
    networks:
      - coding-platform

  worker-code-runner:
    image: worker  # reuse the built image
    command: ["node", "dist/workers/codeRunnerWorker.js"]
    env_file:
      - .env
    networks:
      - coding-platform

  worker-db-ops:
    image: worker
    command: ["node", "dist/workers/dbOperationWorker.js"]
    env_file:
      - .env
    networks:
      - coding-platform

  worker-submission-runner:
    image: worker
    command: ["node", "dist/workers/submissionRunnerWorker.js"]
    env_file:
      - .env
    networks:
      - coding-platform

networks:
  coding-platform:
    external: true
